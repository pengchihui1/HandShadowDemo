<!doctype html>
<html lang="en">
<head>
    <title>js调用摄像头拍照上传图片</title>
    <meta charset="utf-8">
</head>
<body>
<button onclick="openMedia()">开启摄像头</button>
<video id="video" width="500px" height="500px" autoplay="autoplay"></video>
<canvas id="canvas" width="500px" height="500px"></canvas>
<button onclick="takePhoto()">拍照</button>
<img id="imgTag" src="" alt="imgTag">
<button onclick="closeMedia()">关闭摄像头</button>
<script>
    let mediaStreamTrack=null; // 视频对象(全局)
    function openMedia() {
        let constraints = {
            video: { width: 500, height: 500 },
            audio: true
        };
        //获得video摄像头
        let video = document.getElementById('video');     
        let promise = navigator.mediaDevices.getUserMedia(constraints);
        promise.then((mediaStream) => {
            mediaStreamTrack = typeof mediaStream.stop === 'function' ? mediaStream : mediaStream.getTracks()[1];
            video.srcObject = mediaStream;
            video.play();
        });
    }

    // 拍照
    function takePhoto() {
        //获得Canvas对象
        let video = document.getElementById('video');
        let canvas = document.getElementById('canvas');

        // 高分辨率
        canvas.width=canvas. clientWidth*window.devicePixelRatio;
        canvas.height=canvas.clientHeight*window.devicePixelRatio;  

        let ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, 500, 500);

        let bgImg1=new Image()
        bgImg1.src='./assets/image/transparent/dragon1.png'

        let bgImg2=new Image()
        bgImg2.src='./assets/image/transparent/dragon2.png'

        let bgImg3=new Image()
        bgImg3.src='./assets/image/transparent/pikachu1.png'

        let bgImg4=new Image()
        bgImg4.src='./assets/image/transparent/pikachu2.png'

        ctx.drawImage(bgImg1, 0, 0, 100, 100);
        ctx.drawImage(bgImg2, 400, 0, 100, 100);
        ctx.drawImage(bgImg3, 0, 400, 100, 100);
        ctx.drawImage(bgImg4, 400, 400, 100, 100);

        // toDataURL  ---  可传入'image/png'---默认, 'image/jpeg'
        let img = document.getElementById('canvas').toDataURL();
        // 这里的img就是得到的图片
        document.getElementById('imgTag').src=img;
    }

    // 关闭摄像头
    function closeMedia() {
        mediaStreamTrack.stop();
    }

    function drawImages(){

    }
    
</script>
</body>